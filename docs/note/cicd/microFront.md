# 微前端 TODO

::: tip
所谓架构，其实是解决人的问题；

所谓敏捷，其实是解决沟通的问题
:::

## 概念

`微前端`借鉴`微服务`的概念来应用在前端上，将一个巨大的前端工程拆分成一个的小工程，这些小工程具备独立的开发和运行能力，而整个系统就由这些小工程协同合作。

[微前端的核心价值](https://zhuanlan.zhihu.com/p/95085796)在于 "技术栈无关"，这才是它诞生的理由，或者说这才是能说服我们采用微前端方案的理由。

为什么呢？

- 遗留系统迁移。解决遗留系统，才是人们采用微前端方案最重要的原因。

- 聚合前端应用。微服务架构，可以解耦后端服务间依赖。而微前端，则关注于聚合前端应用。

微前端的前提，还是得有主体应用，然后才有微组件或微应用，解决的是可控体系下的前端协同开发问题（含空间分离带来的协作和时间延续带来的升级维护）。

微前端的实现，意味着对前端应用的拆分。拆分应用的目的，并不只是为了架构上好看，还为了提升开发效率。


为此，微前端带来这么一系列的好处：

- 应用自治。只需要遵循统一的接口规范或者框架，以便于系统集成到一起，相互之间是不存在依赖关系的。

- 单一职责。每个前端应用可以只关注于自己所需要完成的功能。

- 技术栈无关。你可以使用 `Angular` 的同时，又可以使用 `React` 和 `Vue`。

除此，它也有一系列的缺点：

- 应用的拆分基础依赖于基础设施的构建，一旦大量应用依赖于同一基础设施，那么维护变成了一个挑战。

- 拆分的粒度越小，便意味着架构变得复杂、维护成本变高。

- 技术栈一旦多样化，便意味着技术栈混乱。

## 为什么不使用 Iframe
为什么不用 iframe，这几乎是所有微前端方案第一个会被 challenge 的问题。但是大部分微前端方案又不约而同放弃了 iframe 方案，自然是有原因的，并不是为了 "炫技" 或者刻意追求 "特立独行"。

如果不考虑体验问题，iframe 几乎是最完美的微前端解决方案了。

iframe 最大的特性就是提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离这类问题统统都能被完美解决。但他的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题。

1. url 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。
2. UI 不同步，DOM 结构不共享。想象一下屏幕右下角 1/4 的 iframe 里来一个带遮罩层的弹框，同时我们要求这个弹框要浏览器居中显示，还要浏览器 resize 时自动居中..
3. 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。
4. 慢。每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程。

其中有的问题比较好解决(问题1)，有的问题我们可以睁一只眼闭一只眼(问题4)，但有的问题我们则很难解决(问题3)甚至无法解决(问题2)，而这些无法解决的问题恰恰又会给产品带来非常严重的体验问题， 最终导致我们舍弃了 iframe 方案。


## 参考

- [微前端的核心价值](https://zhuanlan.zhihu.com/p/95085796)

- [可能是你见过最完善的微前端解决方案](https://yq.aliyun.com/articles/715922)

- [前端微服务化解决方案](https://alili.tech/archive/ea599f7c/)

- [「微前端」- 将微服务理念扩展到前端开发](https://www.jianshu.com/p/1f409df7de45)

- [Vue + qiankun 快速实现前端微服务](https://segmentfault.com/a/1190000021872481)

- [Why Not Iframe](https://www.yuque.com/kuitos/gky7yw/gesexv)
