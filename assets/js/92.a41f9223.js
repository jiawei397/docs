(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{457:function(v,_,e){"use strict";e.r(_);var t=e(25),s=Object(t.a)({},(function(){var v=this,_=v.$createElement,e=v._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"常用跨域解决方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用跨域解决方案"}},[v._v("#")]),v._v(" 常用跨域解决方案")]),v._v(" "),e("p",[v._v("什么是跨域？")]),v._v(" "),e("p",[v._v("简单来说，就是非同源（同协议、同ip、同端口、同域名）的资源请求，就是跨域。它主要是针对浏览器的，服务器之间不存在跨域问题。")]),v._v(" "),e("h2",{attrs:{id:"cors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[v._v("#")]),v._v(" CORS")]),v._v(" "),e("p",[e("code",[v._v("CORS")]),v._v("，全称"),e("code",[v._v("Cross-Origin Resource Sharing")]),v._v("，是一种允许当前域（"),e("code",[v._v("domain")]),v._v("）的资源（比如"),e("code",[v._v("html/js/web service")]),v._v("）被其他域（"),e("code",[v._v("domain")]),v._v("）的脚本请求访问的机制。通常由于同域安全策略（"),e("code",[v._v("the same-origin security policy")]),v._v("）浏览器会禁止这种跨域请求。")]),v._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[v._v("优势")]),v._v(" "),e("p",[v._v("只需要后台修改，前端不需要做任何操作")])]),v._v(" "),e("p",[v._v("这时需要后台设置请求头。以"),e("code",[v._v("nodejs")]),v._v("为例：")]),v._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("res.header('Access-Control-Allow-Origin', '*');\n")])])]),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[v._v("WARNING")]),v._v(" "),e("p",[e("code",[v._v("*")]),v._v("代表所有域都可以访问这个资源，生产环境上，可以设置为具体"),e("code",[v._v("ip")]),v._v("地址。")])]),v._v(" "),e("h2",{attrs:{id:"document-domain"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#document-domain"}},[v._v("#")]),v._v(" document.domain")]),v._v(" "),e("p",[v._v("对于已经有成熟产品体系的公司来说，不同的页面可能放在不同的服务器上，这些服务器域名不同，但是拥有相同的上级域名，比如"),e("code",[v._v("id.qq.com")]),v._v("、"),e("code",[v._v("www.qq.com")]),v._v("、"),e("code",[v._v("user.qzone.qq.com")]),v._v("，它们都有公共的上级域名"),e("code",[v._v("qq.com")]),v._v("。这些页面之间的跨域访问可以通过"),e("code",[v._v("document.domain")]),v._v("来进行。")]),v._v(" "),e("p",[v._v("默认情况下，"),e("code",[v._v("document.domain")]),v._v("存放的是载入文档的服务器的主机名，可以手动设置这个属性，不过是有限制的，只能设置成当前域名或者上级的域名，并且必须要包含一个"),e("code",[v._v(".")]),v._v("号，也就是说不能直接设置成顶级域名。例如："),e("code",[v._v("id.qq.com")]),v._v("，可以设置成"),e("code",[v._v("qq.com")]),v._v("，但是不能设置成"),e("code",[v._v("com")]),v._v("。")]),v._v(" "),e("p",[v._v("具有相同"),e("code",[v._v("document.domain")]),v._v("的页面，就相当于是处在同域名的服务器上，如果协议和端口号也是一致，那它们之间就可以跨域访问数据。")]),v._v(" "),e("p",[v._v("详情可以参考这篇文章："),e("a",{attrs:{href:"https://blog.csdn.net/nlznlz/article/details/79506655",target:"_blank",rel:"noopener noreferrer"}},[v._v("通过document.domain实现跨域访问"),e("OutboundLink")],1)]),v._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[v._v("缺点")]),v._v(" "),e("p",[v._v("有些浏览器不支持，当然是说IE啦。")]),v._v(" "),e("p",[v._v("只适用于不同子域的框架间的交互。")])]),v._v(" "),e("h2",{attrs:{id:"跨文档消息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跨文档消息"}},[v._v("#")]),v._v(" 跨文档消息")]),v._v(" "),e("p",[v._v("跨文档消息则是通过向"),e("code",[v._v("Window")]),v._v("实例发送消息来完成的。")]),v._v(" "),e("p",[v._v("在使用时，软件开发人员需要通过调用"),e("code",[v._v("Window")]),v._v("的"),e("code",[v._v("postMessage()")]),v._v("函数来向该"),e("code",[v._v("Window")]),v._v("实例发送消息。此时"),e("code",[v._v("Window")]),v._v("实例内部的"),e("code",[v._v("onmessage")]),v._v("事件将被触发，进而使得该事件的消息处理函数被调用。")]),v._v(" "),e("p",[v._v("但是在接收到消息的时候，消息处理函数首先需要判断消息来源的合法性，以避免恶意用户通过发送消息的方式来非法执行代码。")]),v._v(" "),e("h2",{attrs:{id:"jsonp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[v._v("#")]),v._v(" JSONP")]),v._v(" "),e("p",[e("code",[v._v("JSONP")]),v._v("则是通过在文档中嵌入一个"),e("code",[v._v("<script>")]),v._v("标记来从另一个域中返回数据。")]),v._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[v._v("缺点")]),v._v(" "),e("p",[v._v("只支持"),e("code",[v._v("get")]),v._v("请求。")])]),v._v(" "),e("h2",{attrs:{id:"代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代理"}},[v._v("#")]),v._v(" 代理")]),v._v(" "),e("p",[v._v("利用服务器不会跨域的原理，使用"),e("code",[v._v("nginx")]),v._v("、"),e("code",[v._v("nodejs")]),v._v("等进行代理，将前后台资源统一在一个域下，就可以实现同源。")]),v._v(" "),e("p",[e("code",[v._v("nodejs")]),v._v("可以参考这一篇："),e("a",{attrs:{href:"../js/nodejs/express"}},[v._v("express代理服务")])])])}),[],!1,null,null,null);_.default=s.exports}}]);