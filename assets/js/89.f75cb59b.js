(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{454:function(v,_,l){"use strict";l.r(_);var t=l(25),i=Object(t.a)({},(function(){var v=this,_=v.$createElement,l=v._self._c||_;return l("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[l("h1",{attrs:{id:"浏览器的渲染原理"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的渲染原理"}},[v._v("#")]),v._v(" 浏览器的渲染原理")]),v._v(" "),l("p",[v._v("其实，这个题目用来回答这道经典面试题《"),l("code",[v._v("在浏览器里，从输入URL到页面展示，这中间发生了什么？")]),v._v("》也是一样的。")]),v._v(" "),l("h2",{attrs:{id:"浏览器的进程"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#浏览器的进程"}},[v._v("#")]),v._v(" 浏览器的进程")]),v._v(" "),l("p",[v._v("首先，先简单说下浏览器的进程。以"),l("code",[v._v("chrome")]),v._v("为例，是多进程模型，一般有以下几个进程：")]),v._v(" "),l("ol",[l("li",[v._v("浏览器进程。主要负责用户交互、子进程管理和文件存储等功能。\n"),l("ul",[l("li",[v._v("UI线程。控制浏览器上的按钮及输入框")]),v._v(" "),l("li",[v._v("存储线程。控制文件等的访问")])])]),v._v(" "),l("li",[v._v("渲染进程。主要负责把"),l("code",[v._v("html")]),v._v("、"),l("code",[v._v("js")]),v._v("、"),l("code",[v._v("css")]),v._v("、图片等资源解析为可以显示和交互的页面。运行在安全沙箱里，为了保障系统的安全。\n"),l("ul",[l("li",[l("code",[v._v("JavaScript")]),v._v("引擎线程。与"),l("code",[v._v("GUI")]),v._v("线程互斥。")]),v._v(" "),l("li",[l("code",[v._v("GUI")]),v._v(" 渲染线程")]),v._v(" "),l("li",[v._v("定时触发器线程")]),v._v(" "),l("li",[v._v("事件触发线程")]),v._v(" "),l("li",[v._v("异步http请求线程")]),v._v(" "),l("li",[v._v("一个合成器线程")]),v._v(" "),l("li",[v._v("多个光栅化线程")])])]),v._v(" "),l("li",[v._v("GPU进程。")]),v._v(" "),l("li",[v._v("插件进程。")]),v._v(" "),l("li",[v._v("网络进程。面向渲染进程、浏览器进程提供网络下载功能。")])]),v._v(" "),l("div",{staticClass:"custom-block tip"},[l("p",{staticClass:"custom-block-title"},[v._v("多进程")]),v._v(" "),l("p",[v._v("优点：提升了浏览器的稳定性、流畅性和安全性。")]),v._v(" "),l("ol",[l("li",[v._v("更高的容错性")]),v._v(" "),l("li",[v._v("更高的安全性和沙盒性（sanboxing）")]),v._v(" "),l("li",[v._v("更高的响应速度")])]),v._v(" "),l("p",[v._v("缺点是：资源占用大，体系架构复杂")])]),v._v(" "),l("h2",{attrs:{id:"请求步骤"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#请求步骤"}},[v._v("#")]),v._v(" 请求步骤")]),v._v(" "),l("p",[v._v("可以分成以下几个步骤：")]),v._v(" "),l("h3",{attrs:{id:"浏览器进程接收到用户输入的url"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#浏览器进程接收到用户输入的url"}},[v._v("#")]),v._v(" 浏览器进程接收到用户输入的URL")]),v._v(" "),l("ol",[l("li",[v._v("判断是否搜索内容。如果是使用搜索引擎，合成新的URL。")]),v._v(" "),l("li",[v._v("如果当前正处于某页面，让当前页执行"),l("code",[v._v("beforeunload")]),v._v("事件的退出操作。")]),v._v(" "),l("li",[v._v("浏览器进程把"),l("code",[v._v("URL")]),v._v("转发给网络进程。")])]),v._v(" "),l("h3",{attrs:{id:"网络进程中发起真正的url请求"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#网络进程中发起真正的url请求"}},[v._v("#")]),v._v(" 网络进程中发起真正的URL请求")]),v._v(" "),l("ol",[l("li",[v._v("判断是否有缓存。有的话，直接返回资源给浏览器进程。")]),v._v(" "),l("li",[v._v("进行"),l("code",[v._v("DNS")]),v._v("域名解析。如果是"),l("code",[v._v("https")]),v._v("，还得建立"),l("code",[v._v("TLS")]),v._v("连接。")]),v._v(" "),l("li",[l("code",[v._v("TCP")]),v._v("连接。三次握手，向服务器发送构建的请示信息。如果是"),l("code",[v._v("http1.1")]),v._v("协议，一个站点会开启6个连接，如果是"),l("code",[v._v("http2.0")]),v._v("，只会发起一个。")]),v._v(" "),l("li",[v._v("服务器生成响应数据，再发送给"),l("code",[v._v("网络进程")]),v._v("。")]),v._v(" "),l("li",[v._v("网络进程接收到响应头数据。\n"),l("ul",[l("li",[v._v("判断状态码。如果需要重定向，则根据返回的"),l("code",[v._v("location")]),v._v("字段跳转，重新发起请求。")]),v._v(" "),l("li",[v._v("判断响应数据类型。如果是字节流，进行下载，本次导航结束。")]),v._v(" "),l("li",[v._v("解析数据，转发给浏览器进程。")])])])]),v._v(" "),l("h3",{attrs:{id:"准备渲染进程"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#准备渲染进程"}},[v._v("#")]),v._v(" 准备渲染进程")]),v._v(" "),l("p",[v._v("检查是否同一站点。相同的协议和根域名，就被认为是同一站点。")]),v._v(" "),l("p",[v._v("如果是，则复用一个进程。否则，会新开一个进程。")]),v._v(" "),l("p",[v._v("当然，这只是"),l("code",[v._v("chrome")]),v._v("的默认策略，也可以进行修改。此处不再赘述。")]),v._v(" "),l("h3",{attrs:{id:"提交文档"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#提交文档"}},[v._v("#")]),v._v(" 提交文档")]),v._v(" "),l("ol",[l("li",[v._v("浏览器进程收到网络进程的响应头数据后，向渲染进程发起提交文档的消息")]),v._v(" "),l("li",[v._v("渲染进程和网络进程建立传输数据的管道")]),v._v(" "),l("li",[v._v("等文档数据传输完成后，渲染进程返回确认提交的消息给浏览器进程。这是告诉浏览器进程：已经准备好接收和解析页面数据了。")]),v._v(" "),l("li",[v._v("浏览器进程更新浏览器界面状态。\n"),l("ul",[l("li",[v._v("安全状态")]),v._v(" "),l("li",[v._v("地址栏的url")]),v._v(" "),l("li",[v._v("前进后退的历史状态")]),v._v(" "),l("li",[v._v("更新web页面")])])])]),v._v(" "),l("h3",{attrs:{id:"渲染阶段"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#渲染阶段"}},[v._v("#")]),v._v(" 渲染阶段")]),v._v(" "),l("ol",[l("li",[v._v("构建"),l("code",[v._v("DOM树")]),v._v("。"),l("code",[v._v("DOM 树")]),v._v("是由 "),l("code",[v._v("DOM")]),v._v(" 元素及属性节点组成的。")]),v._v(" "),l("li",[v._v("样式计算。\n"),l("ul",[l("li",[v._v("把css转换为浏览器所能理解的结构（"),l("code",[v._v("styleSheets")]),v._v("）")]),v._v(" "),l("li",[v._v("转换样式表中的属性值，使其标准化")]),v._v(" "),l("li",[v._v("计算出DOM树中每个节点的具体样式")])])]),v._v(" "),l("li",[v._v("布局阶段。\n"),l("ul",[l("li",[v._v("创建布局树。添加可见节点，忽略不可见节点。")]),v._v(" "),l("li",[v._v("布局计算。")])])]),v._v(" "),l("li",[v._v("分层阶段。\n"),l("ul",[l("li",[v._v("拥有层叠上下文属性的元素会被提升为单独一层")]),v._v(" "),l("li",[v._v("需要裁剪的地方也会被创建为图层")])])]),v._v(" "),l("li",[v._v("绘制阶段。\n"),l("ul",[l("li",[v._v("提供一个有绘制指令的绘制列表。")])])]),v._v(" "),l("li",[v._v("光栅化\n"),l("ul",[l("li",[v._v("主线程把绘制列表提交给合成线程")]),v._v(" "),l("li",[v._v("合成线程按照视口附近的图块优先生成位图\n"),l("ul",[l("li",[v._v("合成线程把图层划分为图块")]),v._v(" "),l("li",[v._v("实际生成位图的操作是由栅格化来执行的")]),v._v(" "),l("li",[v._v("所谓栅格化，就是指将图块转换为位图")]),v._v(" "),l("li",[v._v("使用GPU生成位图的过程叫快速栅格化，生成的位图保存在GPU内存")])])])])]),v._v(" "),l("li",[v._v("合成与显示\n"),l("ul",[l("li",[v._v("合成线程生成一个绘制图块的命令")]),v._v(" "),l("li",[v._v("提交命令给浏览器进程")]),v._v(" "),l("li",[v._v("浏览器进程绘制页面内容到内存")]),v._v(" "),l("li",[v._v("将内存显示到屏幕")])])])]),v._v(" "),l("blockquote",[l("p",[v._v("注：本文主要参考李兵老师的《"),l("a",{attrs:{href:"https://time.geekbang.org/column/intro/100033601",target:"_blank",rel:"noopener noreferrer"}},[v._v("浏览器工作原理与实践"),l("OutboundLink")],1),v._v("》，严重推荐。")])])])}),[],!1,null,null,null);_.default=i.exports}}]);