(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{446:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"图标生成字体文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图标生成字体文件"}},[t._v("#")]),t._v(" 图标生成字体文件")]),t._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("p",[t._v("公司内部使用字体图标，是在阿里的"),a("a",{attrs:{href:"https://www.iconfont.cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("字体图标矢量库"),a("OutboundLink")],1),t._v("中找好图标，添加到组里，再下载下来，把文件提交到我们的"),a("code",[t._v("gitlab")]),t._v("仓库维护起来。")]),t._v(" "),a("p",[t._v("这样当然不方便。")]),t._v(" "),a("p",[t._v("先在"),a("code",[t._v("npm")]),t._v("上搜索了下，没找到类似的方案，但把"),a("code",[t._v("svg")]),t._v("图标生成字体与"),a("code",[t._v("css")]),t._v("的库有，也有把图标放在本地某个文件夹就不用再管的"),a("code",[t._v("loader")]),t._v("，后者是"),a("a",{attrs:{href:"https://www.npmjs.com/package/webfonts-loader",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("webfonts-loader")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("于是我们讨论了一个方案：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("搭建一台服务器，所有的"),a("code",[t._v("svg")]),t._v("图标都放上面")])]),t._v(" "),a("li",[a("p",[t._v("解析"),a("code",[t._v("DOM")]),t._v("中用到的图标名称")])]),t._v(" "),a("li",[a("p",[t._v("请求服务器资源，下载到本地某个目录")])]),t._v(" "),a("li",[a("p",[t._v("按照"),a("code",[t._v("webfonts-loader")]),t._v("的文档，配置这个目录，之后应该开发与打包都OK")])])]),t._v(" "),a("p",[t._v("整体思路很简单，实现起来却有些波折。")]),t._v(" "),a("h2",{attrs:{id:"技术验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术验证"}},[t._v("#")]),t._v(" 技术验证")]),t._v(" "),a("p",[t._v("首先进行技术验证。")]),t._v(" "),a("h3",{attrs:{id:"新建webpack工程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建webpack工程"}},[t._v("#")]),t._v(" 新建webpack工程")]),t._v(" "),a("p",[t._v("我用"),a("code",[t._v("webpack4")]),t._v("创建了一个新的工程，里面添加了"),a("code",[t._v("vue-loader")]),t._v("，在其中一个"),a("code",[t._v("vue")]),t._v("文件里这样使用图标（因为我们主要技术栈是"),a("code",[t._v("vue")]),t._v("，先不考虑其它的）：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('<my-font name="go"></my-font>\n<my-font name="search"></my-font>\n')])])]),a("h3",{attrs:{id:"自定义loader-解析dom-下载图标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义loader-解析dom-下载图标"}},[t._v("#")]),t._v(" 自定义loader，解析DOM，下载图标")]),t._v(" "),a("p",[t._v("自定义一个"),a("code",[t._v("loader")]),t._v("，放在"),a("code",[t._v("vue-loader")]),t._v("的后面，也就是先它执行，对应的"),a("code",[t._v("webpack")]),t._v("的配置如下：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.vue$/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" myfontLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("我的"),a("code",[t._v("loader")]),t._v("作用就是用来解析"),a("code",[t._v("vue")]),t._v("的"),a("code",[t._v("DOM")]),t._v("元素，用正则表达式匹配出"),a("code",[t._v("my-font")]),t._v("的"),a("code",[t._v("name")]),t._v("，再从服务器下载对应的图标到本地目录。")]),t._v(" "),a("h3",{attrs:{id:"使用webfonts-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用webfonts-loader"}},[t._v("#")]),t._v(" 使用webfonts-loader")]),t._v(" "),a("ol",[a("li",[t._v("配置文件\n"),a("code",[t._v("webfonts-loader")]),t._v("的配置文件"),a("code",[t._v("myfont.font.js")]),t._v("是这样的：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'files'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./myfont/*.svg'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fontName'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myfonticons'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classPrefix'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myfonticon-'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'baseSelector'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.myfonticon'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'types'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eot'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'woff'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'woff2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ttf'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'svg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fileName'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app.[fontname].[hash].[ext]'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("其实就是下载到"),a("code",[t._v("myfont")]),t._v("文件夹。")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[a("code",[t._v("webpack")]),t._v("配置")]),t._v(" "),a("p",[a("code",[t._v("webfonts-loader")]),t._v("除了上述配置文件，还需要有额外的"),a("code",[t._v("webpack")]),t._v("配置：")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.font\\.js/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  use"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    MiniCssExtractPlugin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webfonts-loader'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("引入文件\n还需要在入口文件中引入一个"),a("code",[t._v("js")]),t._v("：")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./myfont.font'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("它的原理是，引用了这个文件后，就可以使用"),a("code",[t._v("webfonts-loader")]),t._v("得到配置文件，生成"),a("code",[t._v("css")]),t._v("提供给下一个"),a("code",[t._v("loader")]),t._v("——"),a("code",[t._v("css-loader")]),t._v("，再使用"),a("code",[t._v("MiniCssExtractPlugin.loader")]),t._v("生成单独的"),a("code",[t._v("css")]),t._v("文件。因为它监听配置的"),a("code",[t._v("files")]),t._v("文件夹，所以当文件夹内文件变更后，会触发"),a("code",[t._v("webpack")]),t._v("重新编译，编译后会进行热更新。")]),t._v(" "),a("h3",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),a("p",[t._v("经过测试，开发与打包都没有问题。")]),t._v(" "),a("h2",{attrs:{id:"迁移到vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移到vue"}},[t._v("#")]),t._v(" 迁移到vue")]),t._v(" "),a("h3",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("p",[t._v("我们项目是使用"),a("code",[t._v("vue-cli")]),t._v("创建的，因为内置了"),a("code",[t._v("webpack")]),t._v("，封装了相当多的功能，所以只能通过它暴露的接口修改"),a("code",[t._v("webpack")]),t._v("配置。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("chainWebpack")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kissfont'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/kiss\\.font\\.js/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .use(MiniCssExtractPlugin.loader)")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .loader(MiniCssExtractPlugin.loader)")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .end()")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webfonts-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webfonts-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myfontLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myfontLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("h3",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),a("p",[t._v("问题来了，如果使用"),a("code",[t._v("MiniCssExtractPlugin.loader")]),t._v("会报错。")]),t._v(" "),a("p",[t._v("注释掉后，倒是不报了，但还有另一个问题，首次是因为临时文件夹下面并没有图标，会报错。我的解决方案是每次先加个默认图标。")]),t._v(" "),a("h3",{attrs:{id:"折腾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#折腾"}},[t._v("#")]),t._v(" 折腾")]),t._v(" "),a("p",[t._v("如果我能在图标下载完成后，再生成"),a("code",[t._v("css")]),t._v("与字体文件，是不是更好点？我们知道，"),a("code",[t._v("webpack")]),t._v("的插件提供了大量的钩子函数，在"),a("code",[t._v("loader")]),t._v("中下载完图标，完全可以在插件中干这件事情。")]),t._v(" "),a("p",[t._v("于是开始折腾。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在"),a("code",[t._v("webfonts-loader")]),t._v("代码中，找到用来生成"),a("code",[t._v("css")]),t._v("和字体文件的库——"),a("code",[t._v("@vusion/webfonts-generator")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("code",[t._v("html-webpack-plugin")]),t._v("的钩子函数"),a("code",[t._v("html-webpack-plugin-before-html-processing")]),t._v("，在它期间生成"),a("code",[t._v("css")]),t._v("与字体")])]),t._v(" "),a("li",[a("p",[t._v("把生成的"),a("code",[t._v("css")]),t._v("注入到页面的"),a("code",[t._v("css")]),t._v("标签")])])]),t._v(" "),a("p",[t._v("这时，又出现一个问题：无法"),a("code",[t._v("热更新")]),t._v("。主要是开发环境下会有这种需求。")]),t._v(" "),a("p",[t._v("我进行了下列尝试：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("把"),a("code",[t._v("css")]),t._v("改为用"),a("code",[t._v("js")]),t._v("动态插入到页面，仍使用"),a("code",[t._v("html-webpack-plugin")]),t._v("来注入代码。失败。")])]),t._v(" "),a("li",[a("p",[t._v("开发环境下，"),a("code",[t._v("webpack")]),t._v("把生成的代码是放内存里了，我找到生成"),a("code",[t._v("css")]),t._v("的地方，并将它放到对应的内存（"),a("code",[t._v("compiler.outputFileSystem")]),t._v("，使用的是"),a("code",[t._v("memory-fs")]),t._v("）中。失败。")])]),t._v(" "),a("li",[a("p",[t._v("服务启动时代理我存放"),a("code",[t._v("css")]),t._v("的临时目录（"),a("code",[t._v("config.devServer.contentBase(utils.getTmpDir())")]),t._v("），这样目录下文件有更新，页面就会刷新。发现确实是进行刷新，而不是热更新。失败。")])])]),t._v(" "),a("p",[t._v("怎么办呢？")]),t._v(" "),a("p",[t._v("研究热更新的原理，还是我的"),a("code",[t._v("css")]),t._v("生成的时机不对，不在编译阶段，就没法热更新。可如果在编译阶段，我又无法知道什么时候所有的图标都下载完成。")]),t._v(" "),a("p",[t._v("陷入僵局。")]),t._v(" "),a("p",[t._v("没办法，只能参考"),a("code",[t._v("webfonts-loader")]),t._v("，在入口文件中引入"),a("code",[t._v("css")]),t._v("（"),a("code",[t._v("import 'xx.css'")]),t._v("），再加个"),a("code",[t._v("style-loader")]),t._v("和"),a("code",[t._v("css-loader")]),t._v("专门处理这个"),a("code",[t._v("css")]),t._v("，这样，当这个"),a("code",[t._v("css")]),t._v("有变化时，也能热更新了。")]),t._v(" "),a("p",[t._v("兜兜转转，没想到还是回归了"),a("code",[t._v("webfonts-loader")]),t._v("的思路，好尴尬。")]),t._v(" "),a("h2",{attrs:{id:"过程中遇到的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过程中遇到的问题"}},[t._v("#")]),t._v(" 过程中遇到的问题")]),t._v(" "),a("h3",{attrs:{id:"多进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程"}},[t._v("#")]),t._v(" 多进程")]),t._v(" "),a("p",[a("code",[t._v("parallel")]),t._v("如果配置为"),a("code",[t._v("true")]),t._v("时，会根据"),a("code",[t._v("CPU")]),t._v("的核心数量开启多进程，如果本地存储变量做为中转记录的话，会失效，只能存在临时文件，或者"),a("code",[t._v("process.env")]),t._v("中，后者有个时机问题，只能在进程开始前存入，否则依然会失效。")]),t._v(" "),a("h3",{attrs:{id:"cache-loader缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-loader缓存"}},[t._v("#")]),t._v(" cache-loader缓存")]),t._v(" "),a("p",[a("code",[t._v("vue")]),t._v("文件被默认添加了"),a("code",[t._v("cache-loader")]),t._v("，它在加载一次后，会导致下次跟它相关的"),a("code",[t._v("loader")]),t._v("不会再触发，应该是使用了"),a("code",[t._v("pitch")]),t._v("函数的缘故。")]),t._v(" "),a("p",[t._v("为了打包的图标"),a("code",[t._v("css")]),t._v("能够纯净，需要每次打包都下载需要的图标，这时就得禁止"),a("code",[t._v("cache-loader")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vueRule "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nvueRule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uses"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cache-loader'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nvueRule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fontLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fontLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"require缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#require缓存"}},[t._v("#")]),t._v(" require缓存")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("loader")]),t._v("中，添加对配置文件的监听：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addDependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("但配置文件的读取，是用"),a("code",[t._v("require('xx.js')")]),t._v("这样做的，它有个问题，执行过一次后，就加到内存里了，不会再读取这个文件，于是需要在合适的时候清除一遍缓存：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("通过这个功能，学习了"),a("code",[t._v("webpack")]),t._v("的插件和"),a("code",[t._v("loader")]),t._v("的使用，对"),a("code",[t._v("cache-loader")]),t._v("、"),a("code",[t._v("thread-loader")]),t._v("、"),a("code",[t._v("html-webpack-plugin")]),t._v("以及热更新都有了些了解。")]),t._v(" "),a("blockquote",[a("p",[t._v("最终的插件和使用可以见"),a("a",{attrs:{href:"https://www.npmjs.com/package/kiss-font-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);