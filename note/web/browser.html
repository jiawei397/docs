<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器的渲染原理 | 帝之下都</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="shortcut icon" href="/docs/images/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/docs/assets/css/0.styles.2486ecd9.css" as="style"><link rel="preload" href="/docs/assets/js/app.f6e97648.js" as="script"><link rel="preload" href="/docs/assets/js/2.793e3b27.js" as="script"><link rel="preload" href="/docs/assets/js/89.f75cb59b.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.fed05d33.js"><link rel="prefetch" href="/docs/assets/js/100.75e9de39.js"><link rel="prefetch" href="/docs/assets/js/101.02b71521.js"><link rel="prefetch" href="/docs/assets/js/102.3b98358a.js"><link rel="prefetch" href="/docs/assets/js/103.04976126.js"><link rel="prefetch" href="/docs/assets/js/11.42050f1c.js"><link rel="prefetch" href="/docs/assets/js/12.5ed91251.js"><link rel="prefetch" href="/docs/assets/js/13.760ba031.js"><link rel="prefetch" href="/docs/assets/js/14.fbcf57fe.js"><link rel="prefetch" href="/docs/assets/js/15.e7d172b7.js"><link rel="prefetch" href="/docs/assets/js/16.efc29a58.js"><link rel="prefetch" href="/docs/assets/js/17.bf0efcec.js"><link rel="prefetch" href="/docs/assets/js/18.43607bc5.js"><link rel="prefetch" href="/docs/assets/js/19.249adea3.js"><link rel="prefetch" href="/docs/assets/js/20.0ff2d59c.js"><link rel="prefetch" href="/docs/assets/js/21.86a40b0c.js"><link rel="prefetch" href="/docs/assets/js/22.0c4688a1.js"><link rel="prefetch" href="/docs/assets/js/23.91d70a7b.js"><link rel="prefetch" href="/docs/assets/js/24.3d5b9a61.js"><link rel="prefetch" href="/docs/assets/js/25.0e41904b.js"><link rel="prefetch" href="/docs/assets/js/26.e0a62fe9.js"><link rel="prefetch" href="/docs/assets/js/27.30fb029e.js"><link rel="prefetch" href="/docs/assets/js/28.f90766af.js"><link rel="prefetch" href="/docs/assets/js/29.2ee1cc61.js"><link rel="prefetch" href="/docs/assets/js/3.1503391c.js"><link rel="prefetch" href="/docs/assets/js/30.89f6c4b1.js"><link rel="prefetch" href="/docs/assets/js/31.ad837c60.js"><link rel="prefetch" href="/docs/assets/js/32.52ae32c9.js"><link rel="prefetch" href="/docs/assets/js/33.065b8fee.js"><link rel="prefetch" href="/docs/assets/js/34.a3c50501.js"><link rel="prefetch" href="/docs/assets/js/35.3742e7ec.js"><link rel="prefetch" href="/docs/assets/js/36.aa190ca1.js"><link rel="prefetch" href="/docs/assets/js/37.bcfeb241.js"><link rel="prefetch" href="/docs/assets/js/38.87a44621.js"><link rel="prefetch" href="/docs/assets/js/39.2b181812.js"><link rel="prefetch" href="/docs/assets/js/4.339bc79a.js"><link rel="prefetch" href="/docs/assets/js/40.a1ceb441.js"><link rel="prefetch" href="/docs/assets/js/41.f4074c22.js"><link rel="prefetch" href="/docs/assets/js/42.fb708ddd.js"><link rel="prefetch" href="/docs/assets/js/43.5d23f2a5.js"><link rel="prefetch" href="/docs/assets/js/44.96f2f1f8.js"><link rel="prefetch" href="/docs/assets/js/45.9610846c.js"><link rel="prefetch" href="/docs/assets/js/46.c9183423.js"><link rel="prefetch" href="/docs/assets/js/47.5933b74e.js"><link rel="prefetch" href="/docs/assets/js/48.1395cfd7.js"><link rel="prefetch" href="/docs/assets/js/49.06f773b5.js"><link rel="prefetch" href="/docs/assets/js/5.1ffab86f.js"><link rel="prefetch" href="/docs/assets/js/50.bbcdc7fc.js"><link rel="prefetch" href="/docs/assets/js/51.cbc60f68.js"><link rel="prefetch" href="/docs/assets/js/52.716462d4.js"><link rel="prefetch" href="/docs/assets/js/53.5db04ef8.js"><link rel="prefetch" href="/docs/assets/js/54.ec0d945c.js"><link rel="prefetch" href="/docs/assets/js/55.248a9b45.js"><link rel="prefetch" href="/docs/assets/js/56.09f734f5.js"><link rel="prefetch" href="/docs/assets/js/57.debd0eae.js"><link rel="prefetch" href="/docs/assets/js/58.da917dc3.js"><link rel="prefetch" href="/docs/assets/js/59.b48ef98f.js"><link rel="prefetch" href="/docs/assets/js/6.1f492624.js"><link rel="prefetch" href="/docs/assets/js/60.b547a796.js"><link rel="prefetch" href="/docs/assets/js/61.5a2527ab.js"><link rel="prefetch" href="/docs/assets/js/62.769dd34e.js"><link rel="prefetch" href="/docs/assets/js/63.03433dfa.js"><link rel="prefetch" href="/docs/assets/js/64.a892881e.js"><link rel="prefetch" href="/docs/assets/js/65.6f632179.js"><link rel="prefetch" href="/docs/assets/js/66.ee877b7b.js"><link rel="prefetch" href="/docs/assets/js/67.fab8e4eb.js"><link rel="prefetch" href="/docs/assets/js/68.a6780b45.js"><link rel="prefetch" href="/docs/assets/js/69.6bb021ed.js"><link rel="prefetch" href="/docs/assets/js/7.0fc26f95.js"><link rel="prefetch" href="/docs/assets/js/70.0c446e1b.js"><link rel="prefetch" href="/docs/assets/js/71.3c94982e.js"><link rel="prefetch" href="/docs/assets/js/72.c5086532.js"><link rel="prefetch" href="/docs/assets/js/73.84611fa8.js"><link rel="prefetch" href="/docs/assets/js/74.821e73ea.js"><link rel="prefetch" href="/docs/assets/js/75.93372814.js"><link rel="prefetch" href="/docs/assets/js/76.32805d69.js"><link rel="prefetch" href="/docs/assets/js/77.8b6e001b.js"><link rel="prefetch" href="/docs/assets/js/78.73fca068.js"><link rel="prefetch" href="/docs/assets/js/79.3237b4d0.js"><link rel="prefetch" href="/docs/assets/js/8.20ef8cbd.js"><link rel="prefetch" href="/docs/assets/js/80.f04b3cd2.js"><link rel="prefetch" href="/docs/assets/js/81.0b928fef.js"><link rel="prefetch" href="/docs/assets/js/82.1f68c39e.js"><link rel="prefetch" href="/docs/assets/js/83.bb107f03.js"><link rel="prefetch" href="/docs/assets/js/84.d8762f0f.js"><link rel="prefetch" href="/docs/assets/js/85.4fbed6b0.js"><link rel="prefetch" href="/docs/assets/js/86.533661f8.js"><link rel="prefetch" href="/docs/assets/js/87.2fb845a3.js"><link rel="prefetch" href="/docs/assets/js/88.fd812499.js"><link rel="prefetch" href="/docs/assets/js/9.5338c914.js"><link rel="prefetch" href="/docs/assets/js/90.78199bc6.js"><link rel="prefetch" href="/docs/assets/js/91.c80e96b7.js"><link rel="prefetch" href="/docs/assets/js/92.a41f9223.js"><link rel="prefetch" href="/docs/assets/js/93.8bd795d4.js"><link rel="prefetch" href="/docs/assets/js/94.6d017679.js"><link rel="prefetch" href="/docs/assets/js/95.331edcc1.js"><link rel="prefetch" href="/docs/assets/js/96.f14d1f9f.js"><link rel="prefetch" href="/docs/assets/js/97.c57cf0ad.js"><link rel="prefetch" href="/docs/assets/js/98.635b673f.js"><link rel="prefetch" href="/docs/assets/js/99.65b10748.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.2486ecd9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">帝之下都</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><span class="title">技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术" class="mobile-dropdown-title"><span class="title">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/note/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/go/" class="nav-link">
  go
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/web/" class="nav-link router-link-active">
  web
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/cicd/" class="nav-link">
  持续集成
</a></li></ul></div></div> <a href="https://github.com/jiawei397/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><span class="title">技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术" class="mobile-dropdown-title"><span class="title">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/note/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/go/" class="nav-link">
  go
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/web/" class="nav-link router-link-active">
  web
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/docs/note/cicd/" class="nav-link">
  持续集成
</a></li></ul></div></div> <a href="https://github.com/jiawei397/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>浏览器的渲染原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/note/web/browser.html#浏览器的进程" class="sidebar-link">浏览器的进程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/note/web/browser.html#请求步骤" class="sidebar-link">请求步骤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/note/web/browser.html#浏览器进程接收到用户输入的url" class="sidebar-link">浏览器进程接收到用户输入的URL</a></li><li class="sidebar-sub-header"><a href="/docs/note/web/browser.html#网络进程中发起真正的url请求" class="sidebar-link">网络进程中发起真正的URL请求</a></li><li class="sidebar-sub-header"><a href="/docs/note/web/browser.html#准备渲染进程" class="sidebar-link">准备渲染进程</a></li><li class="sidebar-sub-header"><a href="/docs/note/web/browser.html#提交文档" class="sidebar-link">提交文档</a></li><li class="sidebar-sub-header"><a href="/docs/note/web/browser.html#渲染阶段" class="sidebar-link">渲染阶段</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器的渲染原理"><a href="#浏览器的渲染原理" class="header-anchor">#</a> 浏览器的渲染原理</h1> <p>其实，这个题目用来回答这道经典面试题《<code>在浏览器里，从输入URL到页面展示，这中间发生了什么？</code>》也是一样的。</p> <h2 id="浏览器的进程"><a href="#浏览器的进程" class="header-anchor">#</a> 浏览器的进程</h2> <p>首先，先简单说下浏览器的进程。以<code>chrome</code>为例，是多进程模型，一般有以下几个进程：</p> <ol><li>浏览器进程。主要负责用户交互、子进程管理和文件存储等功能。
<ul><li>UI线程。控制浏览器上的按钮及输入框</li> <li>存储线程。控制文件等的访问</li></ul></li> <li>渲染进程。主要负责把<code>html</code>、<code>js</code>、<code>css</code>、图片等资源解析为可以显示和交互的页面。运行在安全沙箱里，为了保障系统的安全。
<ul><li><code>JavaScript</code>引擎线程。与<code>GUI</code>线程互斥。</li> <li><code>GUI</code> 渲染线程</li> <li>定时触发器线程</li> <li>事件触发线程</li> <li>异步http请求线程</li> <li>一个合成器线程</li> <li>多个光栅化线程</li></ul></li> <li>GPU进程。</li> <li>插件进程。</li> <li>网络进程。面向渲染进程、浏览器进程提供网络下载功能。</li></ol> <div class="custom-block tip"><p class="custom-block-title">多进程</p> <p>优点：提升了浏览器的稳定性、流畅性和安全性。</p> <ol><li>更高的容错性</li> <li>更高的安全性和沙盒性（sanboxing）</li> <li>更高的响应速度</li></ol> <p>缺点是：资源占用大，体系架构复杂</p></div> <h2 id="请求步骤"><a href="#请求步骤" class="header-anchor">#</a> 请求步骤</h2> <p>可以分成以下几个步骤：</p> <h3 id="浏览器进程接收到用户输入的url"><a href="#浏览器进程接收到用户输入的url" class="header-anchor">#</a> 浏览器进程接收到用户输入的URL</h3> <ol><li>判断是否搜索内容。如果是使用搜索引擎，合成新的URL。</li> <li>如果当前正处于某页面，让当前页执行<code>beforeunload</code>事件的退出操作。</li> <li>浏览器进程把<code>URL</code>转发给网络进程。</li></ol> <h3 id="网络进程中发起真正的url请求"><a href="#网络进程中发起真正的url请求" class="header-anchor">#</a> 网络进程中发起真正的URL请求</h3> <ol><li>判断是否有缓存。有的话，直接返回资源给浏览器进程。</li> <li>进行<code>DNS</code>域名解析。如果是<code>https</code>，还得建立<code>TLS</code>连接。</li> <li><code>TCP</code>连接。三次握手，向服务器发送构建的请示信息。如果是<code>http1.1</code>协议，一个站点会开启6个连接，如果是<code>http2.0</code>，只会发起一个。</li> <li>服务器生成响应数据，再发送给<code>网络进程</code>。</li> <li>网络进程接收到响应头数据。
<ul><li>判断状态码。如果需要重定向，则根据返回的<code>location</code>字段跳转，重新发起请求。</li> <li>判断响应数据类型。如果是字节流，进行下载，本次导航结束。</li> <li>解析数据，转发给浏览器进程。</li></ul></li></ol> <h3 id="准备渲染进程"><a href="#准备渲染进程" class="header-anchor">#</a> 准备渲染进程</h3> <p>检查是否同一站点。相同的协议和根域名，就被认为是同一站点。</p> <p>如果是，则复用一个进程。否则，会新开一个进程。</p> <p>当然，这只是<code>chrome</code>的默认策略，也可以进行修改。此处不再赘述。</p> <h3 id="提交文档"><a href="#提交文档" class="header-anchor">#</a> 提交文档</h3> <ol><li>浏览器进程收到网络进程的响应头数据后，向渲染进程发起提交文档的消息</li> <li>渲染进程和网络进程建立传输数据的管道</li> <li>等文档数据传输完成后，渲染进程返回确认提交的消息给浏览器进程。这是告诉浏览器进程：已经准备好接收和解析页面数据了。</li> <li>浏览器进程更新浏览器界面状态。
<ul><li>安全状态</li> <li>地址栏的url</li> <li>前进后退的历史状态</li> <li>更新web页面</li></ul></li></ol> <h3 id="渲染阶段"><a href="#渲染阶段" class="header-anchor">#</a> 渲染阶段</h3> <ol><li>构建<code>DOM树</code>。<code>DOM 树</code>是由 <code>DOM</code> 元素及属性节点组成的。</li> <li>样式计算。
<ul><li>把css转换为浏览器所能理解的结构（<code>styleSheets</code>）</li> <li>转换样式表中的属性值，使其标准化</li> <li>计算出DOM树中每个节点的具体样式</li></ul></li> <li>布局阶段。
<ul><li>创建布局树。添加可见节点，忽略不可见节点。</li> <li>布局计算。</li></ul></li> <li>分层阶段。
<ul><li>拥有层叠上下文属性的元素会被提升为单独一层</li> <li>需要裁剪的地方也会被创建为图层</li></ul></li> <li>绘制阶段。
<ul><li>提供一个有绘制指令的绘制列表。</li></ul></li> <li>光栅化
<ul><li>主线程把绘制列表提交给合成线程</li> <li>合成线程按照视口附近的图块优先生成位图
<ul><li>合成线程把图层划分为图块</li> <li>实际生成位图的操作是由栅格化来执行的</li> <li>所谓栅格化，就是指将图块转换为位图</li> <li>使用GPU生成位图的过程叫快速栅格化，生成的位图保存在GPU内存</li></ul></li></ul></li> <li>合成与显示
<ul><li>合成线程生成一个绘制图块的命令</li> <li>提交命令给浏览器进程</li> <li>浏览器进程绘制页面内容到内存</li> <li>将内存显示到屏幕</li></ul></li></ol> <blockquote><p>注：本文主要参考李兵老师的《<a href="https://time.geekbang.org/column/intro/100033601" target="_blank" rel="noopener noreferrer">浏览器工作原理与实践<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>》，严重推荐。</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/jiawei397/docs/edit/master/docs/note/web/browser.md" target="_blank" rel="noopener noreferrer">提出宝贵意见</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.f6e97648.js" defer></script><script src="/docs/assets/js/2.793e3b27.js" defer></script><script src="/docs/assets/js/89.f75cb59b.js" defer></script>
  </body>
</html>
